---
layout:     post
title:      "nginx配置"
subtitle:   " \"nginx反向代理验证\""
date:       2019-04-01 12:00:00
author:     "Hanamichi"
header-img: "img/spacex-1.jpg"
catalog: true
tags:
    - nginx
---



### 环境说明

* vm1: 192.168.206.196, 运行nginx
* vm2: 192.168.206.197, 运行tomcat 3个不同版本的实例



### 运行tomcat实例

在**vm2**上运行以下服务

1. tomcat1服务

   `docker run -d --name tomcat1 -p 8081:8080 tomcat:8.5.30-alpine`

2. tomcat2服务

   `docker run -d --name tomcat2 -p 8082:8080 tomcat:8.5.35-alpine`

3. tomcat3服务

   `docker run -d --name tomcat3 -p 8082:8080 tomcat:8.5.40-alpine`

### 运行nginx

1. `docker run -d --name nginx -p 80:80 nginx:latest`

2. `docker exec -it nginx bash`

3. `vim /etc/nginx/conf.d/default.conf`,修改nginx配置如下所示

   ```conf
   upstream tomcat1 {
   	server 192.168.206.197:8081;
   }
   
   upstream tomcat2 {
   	server 192.168.206.197:8082;
   }
   
   upstream tomcat3 {
   	server 192.168.206.197:8083;
   }
   server {
       listen       80;
       server_name  test.org;
   
       location / {
           proxy_pass        http://tomcat1;  
           proxy_redirect off;
           proxy_set_header  Host  $host;
           proxy_set_header  X-Real-IP  $remote_addr;  
           proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
       }
       error_page   500 502 503 504  /50x.html;
       location = /50x.html {
           root   /usr/share/nginx/html;
       }
   }
   
   server {
       listen       80;
       server_name  test1.org;
   
       location / {
           proxy_pass        http://tomcat2;  
           proxy_redirect off;
           proxy_set_header  Host  $host;
           proxy_set_header  X-Real-IP  $remote_addr;  
           proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
       }
       error_page   500 502 503 504  /50x.html;
       location = /50x.html {
           root   /usr/share/nginx/html;
       }
   }
   server {
       listen       80;
       server_name  test2.org;
   
       location / {
           proxy_pass        http://tomcat3;  
           proxy_redirect off;
           proxy_set_header  Host  $host;
           proxy_set_header  X-Real-IP  $remote_addr;  
           proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
       }
       error_page   500 502 503 504  /50x.html;
       location = /50x.html {
           root   /usr/share/nginx/html;
       }
   }
   ```

4. 在`/etc/hosts`增加以下条目：

   ```conf
   127.0.0.1  test.org
   127.0.0.1  test1.org
   127.0.0.1  test2.org
   ```

5. 在**vm1**上访问test.org,test1.org,test2.org即可看到不通版本的tomcat首页



nginx的配置详解参考如下文章:

[nginx配置说明](<http://seanlook.com/2015/05/17/nginx-install-and-config/>)