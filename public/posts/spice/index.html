<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>
äº‘æ¡Œé¢spiceåˆæ¢
</title>

    
  <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />



  
  <meta name="author" content="hanamichi" />
  <meta name="description" content="spiceåˆæ¢" />



<meta name="generator" content="Hugo 0.62.2" />

<link rel="canonical" href="https://hanamichi.wiki/posts/spice/" />


<meta property="og:title" content="äº‘æ¡Œé¢spiceåˆæ¢" />
<meta property="og:description" content="spiceåˆæ¢" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hanamichi.wiki/posts/spice/" />
<meta property="article:published_time" content="2017-05-01T14:21:26+08:00" />
<meta property="article:modified_time" content="2017-05-01T14:21:26+08:00" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="äº‘æ¡Œé¢spiceåˆæ¢"/>
<meta name="twitter:description" content="spiceåˆæ¢"/>


<link rel="stylesheet" href="/css/github-markdown.css" />
<link rel="stylesheet" href="/css/semantic.min.css" />
<link rel="stylesheet" href="/css/site.css" />


<style>
  a {
    color: seagreen !important;
  }
</style>



<style>
  .inverted a {
     color: darkseagreen !important;
  }
</style>


  </head>

  
  <body style="background: #84a4b0;">
  
    <div class="flip-container">
      <div class="flipper">
        <section class="front">
          
<nav class="ui secondary inverted menu dream-menu">

  <div class="item">
    <i class="large link bullseye icon dream-flip-toggle" title="ç¿»è½¬ï¼"></i>
  </div>
  <div class="item">
    <i class="large link home icon" title="é¦–é¡µ" onclick="window.location.href = 'https:\/\/hanamichi.wiki'"></i>
  </div>
  <div class="item">
    <i id="theme-switch" class="large link icon" onclick="themeSwitch()"></i>
  </div>
</nav>

          
<div class="ui centered relaxed grid dream-grid">
  <div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single">

    <section class="ui top attached segment" id="dream-save-post-as-img">
      <header style="margin-top: 0 !important;">
        <h2 class="ui header">
          äº‘æ¡Œé¢spiceåˆæ¢
          <div class="sub header">@ hanamichi Â· Monday, May 1, 2017 Â· 10 åˆ†é’Ÿé˜…è¯» Â· æ›´æ–°äº May 1, 2017</div>
        </h2>
      </header>
      <article style="margin-top: 2rem;"><h1 id="spiceåˆæ¢">spiceåˆæ¢</h1>
<ul>
<li><a href="#spice%E5%88%9D%E6%8E%A2">spiceåˆæ¢</a>
<ul>
<li><a href="#%E6%A6%82%E5%BF%B5%E7%BB%93%E6%9E%84">æ¦‚å¿µ&amp;ç»“æ„</a>
<ul>
<li><a href="#spice%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">spiceåŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="#spice%E7%B3%BB%E7%BB%9F%E7%BB%84%E6%88%90">spiceç³»ç»Ÿç»„æˆ</a></li>
<li><a href="#vd-interface">VD-Interface</a></li>
<li><a href="#vdi-back-end">VDI Back-End</a></li>
<li><a href="#vdi-front-end">VDI Front-End</a></li>
<li><a href="#spice-server">spice server</a></li>
<li><a href="#spice-server-1">spice server</a></li>
<li><a href="#%E5%85%AC%E5%85%B1%E5%87%BD%E6%95%B0">å…¬å…±å‡½æ•°</a></li>
<li><a href="#%E4%B8%BB%E8%A6%81vdi%E6%8E%A5%E5%8F%A3">ä¸»è¦VDIæ¥å£</a></li>
<li><a href="#channel">Channel</a></li>
<li><a href="#usbredirect">usbredirect</a></li>
</ul>
</li>
<li><a href="#spice%E5%8D%8F%E8%AE%AE">spiceåè®®</a>
<ul>
<li><a href="#spice%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84">SpiceåŸºæœ¬ç»“æ„</a></li>
<li><a href="#spice%E5%9B%BE%E5%BD%A2%E5%91%BD%E4%BB%A4%E6%B5%81">Spiceå›¾å½¢å‘½ä»¤æµ</a></li>
<li><a href="#spice%E4%BB%A3%E7%90%86%E5%91%BD%E4%BB%A4%E6%B5%81">Spiceä»£ç†å‘½ä»¤æµ</a></li>
<li><a href="#spice-client">Spice  Client</a>
<ul>
<li><a href="#spice-client%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><em>Spice ClientåŸºæœ¬ç»“æ„</em></a></li>
<li><a href="#client-%E7%B1%BB%E7%BB%93%E6%9E%84"><em>Client ç±»ç»“æ„</em></a></li>
<li><a href="#channels"><em>Channels</em></a></li>
<li><a href="#screens-and-windows"><em>Screens and Windows</em></a></li>
</ul>
</li>
<li><a href="#spice-server-2">Spice Server</a>
<ul>
<li><a href="#spice-server-%E7%BB%93%E6%9E%84"><em>spice server ç»“æ„</em></a></li>
<li><a href="#red-server-redsc"><em>red server (reds.c)</em></a></li>
<li><a href="#server-%E5%9B%BE%E5%BD%A2%E5%AD%90%E7%B3%BB%E7%BB%9F"><em>server å›¾å½¢å­ç³»ç»Ÿ</em></a></li>
<li><a href="#red-worker-red_workerc"><em>Red Worker( red_worker.c)</em></a></li>
<li><a href="#red-dispatcherred_dispatcherc"><em>Red Dispatcher(red_dispatcher.c)</em></a></li>
</ul>
</li>
<li><a href="#spice-protocol">Spice Protocol</a></li>
<li><a href="#spice%E8%A7%86%E9%A2%91%E6%B5%81%E5%8E%8B%E7%BC%A9">SPICEè§†é¢‘æµå‹ç¼©</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="æ¦‚å¿µç»“æ„">æ¦‚å¿µ&amp;ç»“æ„</h2>
<h3 id="spiceåŸºæœ¬æ¦‚å¿µ">spiceåŸºæœ¬æ¦‚å¿µ</h3>
<p>spiceæ˜¯ä¸“é—¨ä¸ºè™šæ‹ŸåŒ–ç¯å¢ƒæ„å»ºçš„ä¸€å¥—è¿œç¨‹æ¡Œé¢ç³»ç»Ÿã€‚spiceæŒ‡æ•´å¥—ç³»ç»Ÿï¼Œè€Œä¸æ˜¯å•ä¸ªæ¨¡å—æˆ–ç»„ä»¶ã€‚</p>
<h3 id="spiceç³»ç»Ÿç»„æˆ">spiceç³»ç»Ÿç»„æˆ</h3>
<p><img src="/img/inpost/spice/spice-arch.png" alt="spiceç³»ç»Ÿç»“æ„å›¾"></p>
<ul>
<li>spiceåè®®</li>
<li>spice server</li>
<li>spice client</li>
</ul>
<h3 id="vd-interface">VD-Interface</h3>
<p>VD-Interfaceæ˜¯ä¸€å¥—æ¥å£è§„èŒƒï¼ŒVDI Back-Endä¸VDI Front-Endé€šè¿‡VD-Interfaceè¿›è¡Œäº¤äº’ã€‚</p>
<h3 id="vdi-back-end">VDI Back-End</h3>
<p>VDI Back-Endå…¶å®å°±æ˜¯ä¸€å †QEMU Virtual Deviceï¼Œä½†æ˜¯è¿™äº›Virtual Deviceéƒ½å®ç°äº†VD-Interfaceæ¥å£è§„èŒƒã€‚</p>
<h3 id="vdi-front-end">VDI Front-End</h3>
<p>VDI Front-Endé€šè¿‡è°ƒç”¨VDI Back-Endæä¾›çš„VD-Interfaceæ¥å£æ¥å®ç°ä¸VDI Back-Endçš„äº¤äº’ã€‚</p>
<h3 id="spice-server">spice server</h3>
<p>spice-server ä½œä¸ºVDIçš„å‰ç«¯ï¼Œé€šè¿‡spiceåè®®ä¸spiceå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ã€‚spice-serverä»¥åº“çš„å½¢å¼æä¾›ç»™åç«¯ã€‚</p>
<h3 id="spice-server-1">spice server</h3>
<p><img src="/img/inpost/spice/spice-server.png" alt="spice serverç»“æ„å›¾"></p>
<p>spice serverç¼–è¯‘æˆlibspice,ä½œä¸ºä¸€ä¸ªåŠ¨æ€åº“ç»™åç«¯ï¼ˆé€šå¸¸æ˜¯qemuï¼‰ä½¿ç”¨ã€‚</p>
<h3 id="å…¬å…±å‡½æ•°">å…¬å…±å‡½æ•°</h3>
<p>å…¬å…±å‡½æ•°ä¸ºå¯ä»¥ç»™å¤–éƒ¨æ–‡ä»¶è°ƒç”¨çš„å‡½æ•°ï¼ˆåœ¨è¿™é‡ŒæŒ‡ç”±qemuè°ƒç”¨ï¼‰</p>
<ul>
<li>spice.h:ä¸SpiceServerç»“æ„ä½“ç›¸å…³çš„å‡½æ•°,æ˜¯qemuè°ƒç”¨spiceçš„ä¸»è¦å‡½æ•°</li>
<li>red_dispatcher.h:ä¸QXLè®¾å¤‡ç›¸å…³çš„å‡½æ•°</li>
</ul>
<p>ä¸»è¦å…¬å…±å‡½æ•°ï¼š</p>
<ul>
<li><strong>spice_server_init</strong> :è´Ÿè´£åˆå§‹åŒ–spice_server</li>
<li><strong>spice_server_add_interface</strong> :ç»™serveræ³¨å†ŒVDIæ¥å£</li>
<li><strong>spice_server_add_client</strong> :å¤„ç†qemuæ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯è¿æ¥æ¶ˆæ¯</li>
</ul>
<h3 id="ä¸»è¦vdiæ¥å£">ä¸»è¦VDIæ¥å£</h3>
<ul>
<li>SpiceCoreInterfaceï¼š    Spiceä¸Qemuå†…éƒ¨äº¤äº’ç”¨çš„æ¥å£</li>
<li>QXLInterfaceï¼š          æ˜¾ç¤ºæ•°æ®äº¤äº’æ¥å£</li>
<li>SpiceKbdInstanceï¼š      é”®ç›˜è¾“å…¥äº¤äº’æ¥å£</li>
<li>SpiceMouseInterfaceï¼š   é¼ æ ‡è¾“å…¥äº¤äº’æ¥å£</li>
<li>SpicePlaybackInterfaceï¼šéŸ³é¢‘æ’­æ”¾äº¤äº’æ¥å£</li>
<li>SpiceRecordInterfaceï¼š  éŸ³é¢‘å½•åˆ¶äº¤äº’æ¥å£</li>
</ul>
<h3 id="channel">Channel</h3>
<p>Channelçš„ä¸»è¦ä½œç”¨æ˜¯ä½¿ç”¨å¯¹åº”çš„TCPè¿æ¥ä¼ è¾“æ¶ˆæ¯ç»™å®¢æˆ·ç«¯,ä¿è¯å…¶ä¼ è¾“çš„å¯é æ€§,å…¶æœ¬è´¨æ˜¯é€šé“,ä¸åŒçš„Channelä¼ è¾“ä¸åŒçš„æ¶ˆæ¯.</p>
<p>spiceä¸­ä¸»è¦æœ‰å…­ç§Channel:</p>
<ul>
<li><strong>MainChannel</strong> :ä¸å®¢æˆ·ç«¯è¿æ¥çš„å»ºç«‹å’Œæ–­å¼€æœ‰å…³</li>
<li><strong>InputsChannel</strong> :è·Ÿé¼ æ ‡,é”®ç›˜,è§¦æ‘¸æ¿çš„è¾“å…¥æœ‰å…³</li>
<li><strong>DisplayChannel</strong> :è·Ÿå›¾åƒä¼ è¾“æœ‰å…³</li>
<li><strong>CursorChannel</strong> :è·Ÿé¼ æ ‡æŒ‡é’ˆçš„æ˜¾ç¤ºæœ‰å…³</li>
<li><strong>PlaybackChannel</strong> :è·Ÿæ’­æ”¾å®¿ä¸»æœºçš„å£°éŸ³æœ‰å…³</li>
<li><strong>RecordChannel</strong> :è·Ÿå½•åˆ¶å®¢æˆ·ç«¯çš„å£°éŸ³æœ‰å…³</li>
</ul>
<h3 id="usbredirect">usbredirect</h3>
<p>usbredirectæ˜¯spiceå¯¹USBé‡å®šå‘çš„æ”¯æŒ</p>
<p><img src="/img/inpost/spice/usb-redirection.png" alt="usb_redirection"></p>
<ul>
<li>usb hostç«¯ï¼Œspice clienté€šè¿‡libusbä¸usbå¤–è®¾äº¤äº’</li>
<li>spice clienté€šè¿‡spiceåè®®åœ¨ç‰¹å®šé€šé“ä¸spice serveräº¤äº’</li>
<li>spice serveré€šè¿‡VDIæ¥å£ä¸qemu(redirect.c)äº¤äº’</li>
</ul>
<h2 id="spiceåè®®">spiceåè®®</h2>
<p>SPICE(Simple Protocol for Independent Computing Environment)å…¨ç§°ç‹¬ç«‹è®¡ç®—ç¯å¢ƒç®€å•åè®®ã€‚</p>
<p>Spice æ˜¯ä¸€ä¸ªå¼€æ”¾çš„è¿œç¨‹è®¡ç®—è§£å†³æ–¹æ¡ˆï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥è®¿é—®è¿œç¨‹æœºå™¨æ¡Œé¢å’Œè®¾å¤‡(æ¯”å¦‚é”®ç›˜ï¼Œé¼ æ ‡ï¼Œaudio å’Œ USB)ã€‚é€šè¿‡ Spice æˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨æœ¬åœ°è®¡ç®—æœºä¸€æ ·è®¿é—®è¿œç¨‹æœºå™¨ï¼Œè¿™æ ·å¯ä»¥æŠŠ CPU GPU å¯†é›†å·¥ä½œä»å®¢æˆ·ç«¯ç§»äº¤ç»™è¿œç¨‹é«˜æ€§èƒ½æœºå™¨ã€‚Spice é€‚ç”¨äº LAN å’Œ WANã€‚</p>
<h3 id="spiceåŸºæœ¬ç»“æ„">SpiceåŸºæœ¬ç»“æ„</h3>
<p><img src="/img/inpost/spice/spice_schem.png" alt="spiceæ•´ä½“ç»“æ„å›¾"></p>
<p>spice serverå’Œqemuä¹‹é—´å®ç°äº†vdiçš„ä¸€ç³»åˆ—æ¥å£ï¼Œvdiåç«¯å°±æ˜¯qemuæ¨¡æ‹Ÿçš„å„ç§è®¾å¤‡ï¼Œspice serverä½œä¸ºvdiå‰ç«¯ã€‚</p>
<p>Spiceå¯ä»¥ç»†åˆ†ä¸º4éƒ¨åˆ†:</p>
<ul>
<li>guestç«¯ï¼Œqxl driverå’ŒSPICE VDAgent</li>
<li>hostç«¯ï¼Œspice server ä»¥libspiceåŠ¨æ€åº“å½¢å¼ä¾›è™šæ‹Ÿæœºç›‘æ§ç®¡ç†ç¨‹åº(qemu)åˆ†äº«è™šæ‹Ÿæœº</li>
<li>spice protocolï¼Œspice server ä¸ spice client äº¤äº’éµå¾ªçš„åè®®è§„èŒƒ</li>
<li>clientç«¯ï¼Œç»ˆç«¯ç”¨æˆ·ç›´æ¥äº¤äº’æ“ä½œè™šæ‹Ÿæœº(remote-vieweræˆ–è€…spice-gtk)</li>
</ul>
<h3 id="spiceå›¾å½¢å‘½ä»¤æµ">Spiceå›¾å½¢å‘½ä»¤æµ</h3>
<p><img src="/img/inpost/spice/spice-graphic-flow.png" alt="spiceå›¾å½¢å‘½ä»¤æµ"></p>
<p>ä¸Šå›¾æ˜¾ç¤ºäº† Spice çš„åŸºæœ¬æ¶æ„ï¼Œä»¥åŠ guest åˆ° client ä¹‹é—´ä¼ é€çš„ graphic å‘½ä»¤æ•°æ®æµ</p>
<p>å½“ Guest OS ä¸Šä¸€ä¸ªç”¨æˆ·åº”ç”¨è¯·æ±‚ OS å›¾å½¢å¼•æ“æ‰§è¡Œä¸€ä¸ªæ¸²æŸ“æ“ä½œã€‚å›¾å½¢å¼•æ“ä¼ é€å‘½ä»¤ç»™QXLé©±åŠ¨ï¼ŒQXLé©±åŠ¨ä¼šæŠŠOSå‘½ä»¤è½¬æ¢ä¸ºQXLå‘½ä»¤ç„¶åæ¨é€åˆ°QXLè®¾å¤‡çš„commands RIngç¼“å†²ä¸­ã€‚commands Ring æ˜¯ QXL Device ä¸­çš„ä¸€ä¸ªé˜Ÿåˆ—ã€‚Libspice ä¼šä»è¿™ä¸ª commands Ringå–å¾—å‘½ä»¤æ•°æ®ï¼Œç„¶ååŠ åˆ° graphics å‘½ä»¤æ ‘ä¸Šã€‚æ˜¾ç¤ºæ ‘ä¸ŠåŒ…å«ä¸€ç»„æ“ä½œå‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤çš„æ‰§è¡Œä¼šäº§ç”Ÿæ˜¾ç¤ºå†…å®¹ã€‚è¿™æ£µæ ‘å¯ä»¥ä¼˜åŒ–æ‰é‚£äº›ä¼šè¢«è¦†ç›–æ‰çš„å‘½ä»¤ï¼Œå‘½ä»¤æ ‘è¿˜ç”¨æ¥æ£€æµ‹ video æ•°æ®æµã€‚å½“å‘½ä»¤ä» libspice çš„å‘é€é˜Ÿåˆ—å‘é€ç»™å®¢æˆ·ç«¯æ—¶ï¼Œå‘é€å‘½ä»¤è¢«è½¬æ¢ä¸º Spice åè®®æ¶ˆæ¯ï¼ŒåŒæ—¶è¿™ä¸ªå‘½ä»¤ä»å‘é€é˜Ÿåˆ—å’Œæ ‘ä¸Šç§»é™¤ã€‚</p>
<p>å½“ libspice ä¸å†éœ€è¦ä¸€ä¸ªå‘½ä»¤æ—¶ï¼Œå®ƒè¢«æ¨é€åˆ° release ringã€‚é©±åŠ¨ä½¿ç”¨è¿™ä¸ªé˜Ÿåˆ—æ¥é‡Šæ”¾ç›¸åº”çš„å‘½ä»¤èµ„æº</p>
<p>å½“å®¢æˆ·ç«¯ä» libspice æ¥æ”¶åˆ°ä¸€ä¸ªå‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥æ›´æ–°æ˜¾ç¤ºã€‚</p>
<h3 id="spiceä»£ç†å‘½ä»¤æµ">Spiceä»£ç†å‘½ä»¤æµ</h3>
<p><img src="/img/inpost/spice/spice-agent-flow.png" alt="spiceä»£ç†å‘½ä»¤æµ"></p>
<p>Spice ä»£ç†æ˜¯ guest ä¸­çš„ä¸€ä¸ªè½¯ä»¶æ¨¡å—ã€‚Spice server å’Œ Spice client ä½¿ç”¨ä»£ç†æ¥æ‰§è¡Œåœ¨guest ä¸Šä¸‹æ–‡ä¸­çš„å·¥ä½œï¼Œæ¯”å¦‚é…ç½® guest display è®¾ç½®ã€‚ä¸Šå›¾æ˜¾ç¤ºäº† spice client å’Œ server é€šè¿‡ VDI Porté©±åŠ¨å’ŒVDI Portè®¾å¤‡è¿›è¡Œé€šä¿¡çš„è¿‡ç¨‹ã€‚Message åŒ…æ‹¬ client ç”Ÿæˆçš„ guest æ˜¾ç¤ºé…ç½®ä¿¡æ¯ï¼Œserverç”Ÿæˆçš„é¼ æ ‡ç§»åŠ¨ä¿¡æ¯ä»¥åŠä»£ç†ç”Ÿæˆçš„é…ç½®åº”ç­”ä¿¡æ¯ã€‚é©±åŠ¨ä½¿ç”¨ Input/Output Rings å’Œ VDI Port Device é€šä¿¡ã€‚client å’Œ server ç”Ÿæˆçš„ä¿¡æ¯éƒ½å†™å…¥åˆ°åŒä¸€ä¸ªå†™é˜Ÿåˆ—ä¸­ï¼Œç„¶åå†å†™å…¥ VDI Port Device çš„ output buffer ringã€‚Message port å†³å®š message è¢« server å¤„ç†è¿˜æ˜¯æ¨é€ç»™ client å¤„ç†ã€‚</p>
<h3 id="spice--client">Spice  Client</h3>
<p>spice è·¨å¹³å°(Linux &amp; Windows)å®¢æˆ·ç«¯æ˜¯ç»ˆç«¯ç”¨æˆ·çš„æ¥å£</p>
<h4 id="spice-clientåŸºæœ¬ç»“æ„"><em>Spice ClientåŸºæœ¬ç»“æ„</em></h4>
<p><img src="/img/inpost/spice/spice-client.png" alt="spice clientåŸºæœ¬ç»“æ„"></p>
<h4 id="client-ç±»ç»“æ„"><em>Client ç±»ç»“æ„</em></h4>
<p>ä¸ºäº†æœ‰ä¸€ä¸ªæ¸…æ™°çš„è·¨å¹³å°ç»“æ„ï¼ŒSpice å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„æ¥å£ï¼Œè€ŒæŠŠå¹³å°ç›¸å…³çš„å®ç°æ”¾åœ¨äº†ä¸€ä¸ªå¹¶è¡Œçš„ç›®å½•ä¸­ã€‚è¿™ä¸ªé€šç”¨çš„æ¥å£å°±æ˜¯ Platform classï¼Œå®šä¹‰äº†è®¸å¤šä½çº§æœåŠ¡ï¼Œæ¯”å¦‚ timer å’Œ cursor æ“ä½œã€‚</p>
<p><strong>Application</strong>æ˜¯ä¸€ä¸ªä¸»è¦çš„ç±»ï¼ŒåŒ…å« Clientsï¼Œ monitos å’Œ screensï¼Œè¿™ä¸ªç±»å®ç°äº†é€šç”¨çš„åº”ç”¨åŠŸèƒ½:å‘½ä»¤è¡Œè§£æï¼Œä¸»å¾ªç¯ï¼Œæ—¶é—´å¤„ç†ï¼Œé¼ æ ‡äº‹ä»¶é‡å®šå‘ï¼Œå…¨å±åˆ‡æ¢ç­‰ç­‰ã€‚</p>
<h4 id="channels"><em>Channels</em></h4>
<p>client å’Œ server é€šè¿‡ channels è¿›è¡Œé€šä¿¡ï¼Œæ¯ä¸€ä¸ª channel ç±»å‹å¯¹åº”ç€ç‰¹å®šçš„æ•°æ®ç±»å‹ã€‚æ¯ä¸ª channel ä½¿ç”¨ä¸“é—¨çš„ TCP socketï¼Œè¿™ä¸ªsocketå¯ä»¥æ˜¯å®‰å…¨çš„(ä½¿ç”¨SSL)æˆ–è€…ä¸å®‰å…¨çš„ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œæ¯ä¸€ä¸ª channel ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸€ä¸ª channel è®¾ç½®å•ç‹¬çš„ä¼˜å…ˆçº§æ¥è¾¾åˆ°ä¸åŒçš„ QoSã€‚</p>
<p><strong>RedClient</strong>æ˜¯ä¸» channelã€‚å®ƒæ‹¥æœ‰æ‰€æœ‰å…¶ä»–çš„å®ä¾‹åŒ–é€šé“ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶ä»–ä»¬(åˆ›å»ºï¼Œè¿æ¥ï¼Œæ–­å¼€ç­‰)ï¼Œå¹¶ä¸”å¤„ç†æ§åˆ¶ï¼Œé…ç½®å’Œè¿å¾™ã€‚</p>
<p>ä¸»è¦çš„é€šé“æœ‰:</p>
<ul>
<li>Main : ç”±RedClientå®ç°</li>
<li>DisplayChannel : å¤„ç†å›¾å½¢åŒ–å‘½ä»¤ï¼Œå›¾åƒå’Œæ•°æ®æµ</li>
<li>InputsChannel : é¼ æ ‡å’Œé”®ç›˜è¾“å…¥</li>
<li>CursorChannel : æŒ‡é’ˆè®¾å¤‡ä½ç½®ï¼Œæ˜¾ç¤ºå’Œå…‰æ ‡å½¢çŠ¶</li>
<li>PlaybackChannel : ä»æœåŠ¡å™¨æ¥æ”¶éŸ³é¢‘æ•°æ®ï¼Œåœ¨clientæ’­æ”¾</li>
<li>RecordChannel : åœ¨clientç«¯è¿›è¡Œå½•éŸ³</li>
</ul>
<h4 id="screens-and-windows"><em>Screens and Windows</em></h4>
<ul>
<li>Screen layer : ç»‘å®šåˆ°ç‰¹å®šçš„screen,ç”¨æ¥æä¾›çŸ©å½¢åŒºåŸŸçš„æ“ä½œ(è®¾ç½®ï¼Œæ¸…é™¤ï¼Œæ›´æ–°ç­‰)ï¼Œlayer æ˜¯z-ordered</li>
<li>RedScreen : å®ç°screençš„é€»è¾‘ï¼Œæ§åˆ¶windowï¼Œä½¿ç”¨screen layeræ˜¾ç¤ºå…¶å†…å®¹</li>
<li>RedDrawable : åŸºæœ¬ pixmap çš„å¹³å°ç‰¹å®šå®ç°ã€‚å®ƒæ”¯æŒåŸºæœ¬çš„æ¸²æŸ“æ“ä½œ</li>
<li>RedWindow_p : å¹³å°ç›¸å…³çš„windowæ•°æ®å’Œæ–¹æ³•
RedWindow : ç»§æ‰¿è‡ªRedDrawableå’ŒRedWindow_pï¼ŒåŸºæœ¬çª—å£çŠ¶æ€å’ŒåŠŸèƒ½(æ˜¾ç¤ºï¼Œéšè—ï¼Œè®¾ç½®æ ‡é¢˜ï¼Œè®¾ç½®æŒ‡é’ˆè®¾å¤‡ç­‰)çš„è·¨å¹³å°çš„å®ç°</li>
</ul>
<h3 id="spice-server-2">Spice Server</h3>
<p>spice server æ˜¯é€šè¿‡ libspice å’Œ VDI library å®ç°çš„ã€‚VDI æä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„æ–¹æ³•æ¥å‘å¸ƒè™šæ‹Ÿè®¾å¤‡çš„æ¥å£ã€‚è¿™ä½¿å¾—å…¶ä»–çš„è½¯ä»¶éƒ¨ä»¶å¯ä»¥å’Œè¿™äº› virtual device äº¤äº’ã€‚</p>
<p>ä¸€æ–¹é¢ï¼Œserver ä½¿ç”¨ Spice åè®®å’Œè¿œç¨‹ client é€šä¿¡ï¼Œå¦ä¸€æ–¹é¢ï¼Œå®ƒå’Œ VDI host åº”ç”¨(QEMU)è¿›è¡Œäº¤äº’ã€‚</p>
<p>server ä¸ºäº†è¿œç¨‹æ˜¾ç¤ºçš„ç›®çš„ï¼Œserver ç»´æŠ¤äº†ä¸€ä¸ªå‘½ä»¤åºåˆ—å’Œä¸€æ£µæ ‘æ¥ç®¡ç†å½“å‰å¯¹è±¡çš„ä¾èµ–å…³ç³»å’Œè¦†ç›–å…³ç³»ã€‚QXL å‘½ä»¤è¢«å¤„ç†è½¬æ¢ä¸º Spice åè®®ï¼Œç„¶åå‘é€ç»™å®¢æˆ·ç«¯ã€‚</p>
<h4 id="spice-server-ç»“æ„"><em>spice server ç»“æ„</em></h4>
<p><img src="/img/inpost/spice/spice-server.png" alt="spice clientåŸºæœ¬ç»“æ„"></p>
<p>Server é€šè¿‡ channels å’Œ client é€šä¿¡ã€‚æ¯ä¸€ä¸ª channel ç±»å‹å¯¹åº”ä¸€ç§ç‰¹å®šç±»å‹çš„æ•°æ®ã€‚æ¯ä¸€ä¸ª channel ä½¿ç”¨ä¸“ç”¨çš„ TCP socketã€‚æœåŠ¡ç«¯çš„ channel å’Œ client çš„ channel æ˜¯å¯¹åº”çš„ï¼Œä¹Ÿæœ‰Mainã€ Inputsã€Displayã€Cursorã€Playback å’Œ Recordè¿™äº›ç®¡é“ã€‚</p>
<p>Mainå’ŒInput Channelè¢«å¤„ç†å‡½æ•°æ§åˆ¶(å®ç°ä½äºreds.c) ï¼Œdisplayå’Œcursor channelè¢«æ¯ä¸ªdisplayçš„redworkçº¿ç¨‹æ§åˆ¶ï¼Œlibspiceå’ŒVDI Hoståº”ç”¨ç¨‹åº(QEMU)é€šè¿‡æ¯ä¸ªåŠŸèƒ½ç»“æ„äº¤äº’(qxl,agent ç­‰)ã€‚</p>
<h4 id="red-server-redsc"><em>red server (reds.c)</em></h4>
<p>Serverè‡ªèº«ï¼Œç”¨æ¥ç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œæ¥å—è¿æ¥å¹¶ä¸å®¢æˆ·ç«¯é€šä¿¡ï¼Œä¸»è¦è´Ÿè´£å¦‚ä¸‹å·¥ä½œ:</p>
<ul>
<li>é€šé“
<ul>
<li>ç®¡ç†é€šé“(æ³¨å†Œï¼Œæ³¨é”€ï¼Œåœæ­¢)</li>
<li>é€šçŸ¥clientæ´»åŠ¨çš„é€šé“ï¼Œä¾¿äºclient åˆ›å»ºå®ƒä»¬</li>
<li>mainå’Œinputé€šé“çš„ç®¡ç†</li>
<li>è¿æ¥çš„å»ºç«‹(main å’Œå…¶ä»–é€šé“)</li>
<li>socketæ“ä½œä»¥åŠé“¾æ¥ç®¡ç†</li>
<li>å¤„ç†SSLå’Œticketing</li>
</ul>
</li>
<li>VDIæ¥å£å¤„ç†(å¢åŠ ï¼Œç§»é™¤)</li>
<li>è¿ç§»è¿›ç¨‹åä½œ</li>
<li>å¤„ç†ç”¨æˆ·å‘½ä»¤(æ¥è‡ªQEMU monitor)</li>
<li>å’Œguest agenté€šä¿¡</li>
<li>Statistics ç»Ÿè®¡ï¼Ÿ</li>
</ul>
<h4 id="server-å›¾å½¢å­ç³»ç»Ÿ"><em>server å›¾å½¢å­ç³»ç»Ÿ</em></h4>
<p><img src="/img/inpost/spice/spice-server-graphic.png" alt="spice clientåŸºæœ¬ç»“æ„"></p>
<p>ä¸åƒ Spice ä¸­çš„å…¶ä»–å­ç³»ç»Ÿï¼Œgraphics å­ç³»ç»Ÿåœ¨ server ä¸­é€šè¿‡ä¸“æœ‰çš„çº¿ç¨‹å¹¶è¡Œè¿è¡Œã€‚è¿™ç§ç»“æ„ä½¿å¾—å›¾å½¢å‘½ä»¤çš„å¤„ç†å’Œæ¸²æŸ“ä¿æŒç‹¬ç«‹ï¼Œå› æ­¤æ¶ˆè€—å¾ˆå¤šçš„ CPUèµ„æºã€‚</p>
<p>ä¸Šå›¾æ˜¾ç¤ºäº† Spice server å›¾å½¢å­ç³»ç»Ÿçš„ç»“æ„ã€‚Red server å®ä¾‹åŒ–ä¸€ä¸ª dispatcherï¼Œå¹¶å¸¦æœ‰ QXL interfaceã€‚dispatcher ä¸ºè¿™ä¸ª QXL interface åˆ›å»º red workerã€‚worker å¤„ç†çš„å‘½ä»¤æœ‰ä¸‰ä¸ªæ¥æº:</p>
<ol>
<li>åŒæ­¥çš„ QXL è®¾å¤‡å‘½ä»¤</li>
<li>red server commands</li>
<li>å¼‚æ­¥çš„ QXL è®¾å¤‡å‘½ä»¤</li>
</ol>
<p>å…¶ä¸­1å’Œ2ç”±dispatcheré€šè¿‡socketåˆ†å‘ï¼Œ3ç”±workerä»QXL device rings pull</p>
<h4 id="red-worker-red_workerc"><em>Red Worker( red_worker.c)</em></h4>
<p>red workerè´Ÿè´£:</p>
<ul>
<li>å¤„ç†QXLè®¾å¤‡å‘½ä»¤(draw, update, cursorç­‰)</li>
<li>å¤„ç†æ¥å—è‡ªdispatcherçš„æ¶ˆæ¯</li>
<li>display å’Œ cursor é€šé“ç®¡ç†</li>
<li>å›¾ç‰‡å‹ç¼©(ä½¿ç”¨quic, lz, glz ç¼–ç )</li>
<li>è§†é¢‘æµå¤„ç†(é‰´åˆ«è§†é¢‘æµï¼Œç¼–ç å’Œåˆ›å»ºæµ)</li>
<li>Ringæ“ä½œ</li>
</ul>
<h4 id="red-dispatcherred_dispatcherc"><em>Red Dispatcher(red_dispatcher.c)</em></h4>
<ul>
<li>ä¸ºæ¯ä¸ªQXLè®¾å¤‡çŠ¶æ€è°ƒåº¦åˆ°å…·ä½“çš„å¤„ç†å‡½æ•°</li>
<li>åˆ›å»ºred workerçº¿ç¨‹</li>
<li>&hellip;è¿˜æœªçœ‹</li>
</ul>
<h3 id="spice-protocol">Spice Protocol</h3>
<p>spice protocol ç”¨äº client å’Œ server é—´çš„é€šä¿¡. æ¯”å¦‚ä¼ è¾“å›¾å½¢å¯¹è±¡, é”®ç›˜å’Œé¼ æ ‡äº‹ä»¶, å…‰æ ‡
ä¿¡æ¯, audio playback å’Œå½•éŸ³ï¼Œä»¥åŠæ§åˆ¶å‘½ä»¤ã€‚</p>
<h3 id="spiceè§†é¢‘æµå‹ç¼©">SPICEè§†é¢‘æµå‹ç¼©</h3>
<p>spice å¤„ç†è§†é¢‘æµæœ‰ä¸¤å¥—æ–¹æ¡ˆ:</p>
<ul>
<li>Spice é›†æˆçš„mjpegç¼–ç </li>
<li>ä½¿ç”¨gstreameræ¡†æ¶ç¼–ç </li>
</ul>
<p>å…¶ä¸­ä½¿ç”¨gstreameræ¡†æ¶å¯ä»¥ä½¿ç”¨çš„ç¼–ç æ ¼å¼(spice ç›®å‰æ”¯æŒçš„)æœ‰mjpeg, h264, vp8, å‡é‡‡ç”¨CPUç¼–ç ã€‚</p>
<p>spice æŠ½è±¡äº†ä¸€ä¸ª<code>VideoEncoder</code>ç»“æ„ä½“ï¼Œè°ƒç”¨ç»Ÿä¸€çš„æ¥å£è¿›è¡Œç¼–ç çš„ä¸€ç³»åˆ—æ“ä½œï¼Œç¼–ç æ–¹æ¡ˆå’Œç¼–ç æ“ä½œæ²¡æœ‰è€¦åˆåœ¨ä¸€èµ·ï¼Œç›¸äº’é€æ˜ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> VideoEncoder VideoEncoder;
<span style="color:#66d9ef">struct</span> VideoEncoder {
    <span style="color:#75715e">/* Releases the video encoder&#39;s resources */</span>
    <span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>destroy)(VideoEncoder <span style="color:#f92672">*</span>encoder);

    <span style="color:#66d9ef">int</span> (<span style="color:#f92672">*</span>encode_frame)(VideoEncoder <span style="color:#f92672">*</span>encoder, uint32_t frame_mm_time,
                        <span style="color:#66d9ef">const</span> SpiceBitmap <span style="color:#f92672">*</span>bitmap,
                        <span style="color:#66d9ef">const</span> SpiceRect <span style="color:#f92672">*</span>src, <span style="color:#66d9ef">int</span> top_down,
                        gpointer bitmap_opaque, VideoBuffer<span style="color:#f92672">*</span><span style="color:#f92672">*</span> outbuf);

    <span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>client_stream_report)(VideoEncoder <span style="color:#f92672">*</span>encoder,
                                 uint32_t num_frames, uint32_t num_drops,
                                 uint32_t start_frame_mm_time,
                                 uint32_t end_frame_mm_time,
                                 int32_t end_frame_delay, uint32_t audio_delay);

    <span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>notify_server_frame_drop)(VideoEncoder <span style="color:#f92672">*</span>encoder);

    uint64_t (<span style="color:#f92672">*</span>get_bit_rate)(VideoEncoder <span style="color:#f92672">*</span>encoder);

    <span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>get_stats)(VideoEncoder <span style="color:#f92672">*</span>encoder, VideoEncoderStats <span style="color:#f92672">*</span>stats);

    SpiceVideoCodecType codec_type;
};

<span style="color:#66d9ef">typedef</span> VideoEncoder<span style="color:#f92672">*</span> (<span style="color:#f92672">*</span>new_video_encoder_t)(SpiceVideoCodecType codec_type,
                                             uint64_t starting_bit_rate,
                                             VideoEncoderRateControlCbs <span style="color:#f92672">*</span>cbs,
                                             bitmap_ref_t bitmap_ref,
                                             bitmap_unref_t bitmap_unref);

VideoEncoder<span style="color:#f92672">*</span> <span style="color:#a6e22e">mjpeg_encoder_new</span>(SpiceVideoCodecType codec_type,
                                uint64_t starting_bit_rate,
                                VideoEncoderRateControlCbs <span style="color:#f92672">*</span>cbs,
                                bitmap_ref_t bitmap_ref,
                                bitmap_unref_t bitmap_unref);

<span style="color:#75715e">#</span><span style="color:#75715e">if defined(HAVE_GSTREAMER_1_0) || defined(HAVE_GSTREAMER_0_10)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
VideoEncoder<span style="color:#f92672">*</span> <span style="color:#a6e22e">gstreamer_encoder_new</span>(SpiceVideoCodecType codec_type,
                                    uint64_t starting_bit_rate,
                                    VideoEncoderRateControlCbs <span style="color:#f92672">*</span>cbs,
                                    bitmap_ref_t bitmap_ref,
                                    bitmap_unref_t bitmap_unref);
<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> RedVideoCodec {
    new_video_encoder_t create;
    SpiceVideoCodecType type;
    uint32_t cap;
} RedVideoCodec;
</code></pre></div><p>ä¸Šé¢çš„ä»£ç æ®µæ˜¯ç¼–ç å™¨<code> VideoEncoder</code>çš„ç»“æ„ä½“å®šä¹‰å’Œä¸¤ç§ç¼–ç æ–¹æ¡ˆçš„ç¼–ç å™¨åˆ›å»ºå‡½æ•°å£°æ˜ã€‚åœ¨åˆ›å»ºç¼–ç å™¨å‡½æ•°çš„å®ç°ä¸­ä¼šåˆ›å»ºç›¸åº”çš„ç¼–ç å™¨å®ä¾‹ï¼Œå¡«å……<code>VideoEncoder</code>ç»“æ„ä½“ï¼Œå¹¶å°†ç¼–ç å™¨å®ä¾‹è¿”å›ã€‚<strong>ç¼–ç å™¨åªä¼šåœ¨æ»¡è¶³åˆ›å»ºæµçš„æ¡ä»¶åè¢«è°ƒç”¨åˆ›å»º</strong>ã€‚</p>
<p><img src="/img/inpost/spice/spice1.png" alt="spice video encoder"></p>
<p>å¯åŠ¨è™šæ‹Ÿæœºï¼Œå³QEMUè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œä¼šåˆ†æå‘½ä»¤è¡Œå‚æ•°ï¼Œå¦‚æœæŒ‡å®šäº†ä½¿ç”¨spiceï¼Œåˆ™ä¼šè°ƒç”¨spiceçš„åˆå§‹åŒ–å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚æ­¤æ—¶ä¼šå°†spice server ç«¯æ”¯æŒçš„è§†é¢‘ç¼–ç æ ¼å¼åŠ å…¥ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä»¥ä¾¿åœ¨ä¹‹ååˆ›å»ºç¼–ç å™¨çš„æ—¶å€™ä½¿ç”¨ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">static</span> VideoEncoder<span style="color:#f92672">*</span> <span style="color:#a6e22e">dcc_create_video_encoder</span>(DisplayChannelClient <span style="color:#f92672">*</span>dcc,
                                              uint64_t starting_bit_rate,
                                              VideoEncoderRateControlCbs <span style="color:#f92672">*</span>cbs)
{
    DisplayChannel <span style="color:#f92672">*</span>display <span style="color:#f92672">=</span> DCC_TO_DC(dcc);
    RedChannelClient <span style="color:#f92672">*</span>rcc <span style="color:#f92672">=</span> RED_CHANNEL_CLIENT(dcc);
    <span style="color:#66d9ef">int</span> client_has_multi_codec <span style="color:#f92672">=</span> red_channel_client_test_remote_cap(rcc, SPICE_DISPLAY_CAP_MULTI_CODEC);
    <span style="color:#66d9ef">int</span> i;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> display<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>priv<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>video_codecs<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>len; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        RedVideoCodec<span style="color:#f92672">*</span> video_codec <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>g_array_index (display<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>priv<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>video_codecs, RedVideoCodec, i);

        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>client_has_multi_codec <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span>
            video_codec<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>type <span style="color:#f92672">!</span><span style="color:#f92672">=</span> SPICE_VIDEO_CODEC_TYPE_MJPEG) {
            <span style="color:#75715e">/* Old clients only support MJPEG */</span>
            <span style="color:#66d9ef">continue</span>;
        }
        <span style="color:#66d9ef">if</span> (client_has_multi_codec <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span>
            <span style="color:#f92672">!</span>red_channel_client_test_remote_cap(rcc, video_codec<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>cap)) {
            <span style="color:#75715e">/* The client is recent but does not support this codec */</span>
            <span style="color:#66d9ef">continue</span>;
        }

        VideoEncoder<span style="color:#f92672">*</span> video_encoder <span style="color:#f92672">=</span> video_codec<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>create(video_codec<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>type, starting_bit_rate, cbs, bitmap_ref, bitmap_unref);
        <span style="color:#66d9ef">if</span> (video_encoder) {
            <span style="color:#66d9ef">return</span> video_encoder;
        }
    }

    <span style="color:#75715e">/* Try to use the builtin MJPEG video encoder as a fallback */</span>
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>client_has_multi_codec <span style="color:#f92672">|</span><span style="color:#f92672">|</span> red_channel_client_test_remote_cap(rcc, SPICE_DISPLAY_CAP_CODEC_MJPEG)) {
        <span style="color:#66d9ef">return</span> mjpeg_encoder_new(SPICE_VIDEO_CODEC_TYPE_MJPEG, starting_bit_rate, cbs, bitmap_ref, bitmap_unref);
    }

    <span style="color:#66d9ef">return</span> NULL;
}
</code></pre></div><p>åœ¨åˆ›å»ºç¼–ç å™¨ä¹‹å‰ä¼šå¯¹è¯¢é—®å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒå¤šä¸ªç¼–ç ï¼Œä¹‹åå¯¹ä¹‹å‰åˆå§‹åŒ–çš„ç¼–ç æ ¼å¼æ•°ç»„æŒ‰é¡ºåºè¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœå®¢æˆ·ç«¯æ”¯æŒï¼Œåˆ™åˆ›å»ºç¼–ç å™¨è¿”å›ã€‚å¦‚æœæ•°ç»„ä¸­çš„æ‰€æœ‰æ ¼å¼éƒ½ä¸æ”¯æŒï¼Œåˆ™é€‰ç”¨é»˜è®¤çš„mjpegæ ¼å¼ç¼–ç ã€‚</p>
<p><img src="/img/inpost/spice/spice2.png" alt="spice video stream"></p>
<p>ä¸Šå›¾æ˜¯spiceä¸­è§†é¢‘å‘½ä»¤æµçš„ä¸»è¦å‡½æ•°æµç¨‹å›¾ã€‚å…¶ä¸­å·¦å›¾æ˜¯å¾—åˆ°qxlç»˜å›¾æŒ‡ä»¤åæ‰§è¡Œå„ç§æ“ä½œåæŠŠè§†é¢‘æµå‘é€ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>ä¸­å›¾æ˜¯å¤„ç†displayå‘½ä»¤çš„å…·ä½“æ‰§è¡Œå‡½æ•°ï¼Œåªæœ‰<strong>qxlçš„å‘½ä»¤æ˜¯ç»˜å›¾æŒ‡ä»¤</strong>æ‰ä¼šè¿›è¡Œä¹‹åçš„ç»˜å›¾åŒºåŸŸåˆ›å»ºå’Œç»´æŠ¤æ¸²æŸ“æ ‘åˆ›å»ºæµç­‰æ“ä½œã€‚</p>
<p>å³å›¾æ˜¯<code>current_add</code>å‡½æ•°ä¸­çš„å…·ä½“æµç¨‹ï¼Œç»´æŠ¤æ ‘çš„åŒæ—¶ï¼Œå°†è¿›è¡Œæ˜¯å¦åˆ›å»ºæµçš„åˆ¤æ–­ï¼Œæ¡ä»¶æ˜¯<strong>å¸§ç‡å¤§äº20fpsï¼Œä¸”æœ‰4ä¸ªæ¸è¿›å¸§</strong></p>
<p>spiceä¸­å…³äºgstreamerçš„ä½¿ç”¨æ”¾åœ¨gstreamerä»‹ç»ä¸­ä½œä¸ºæ ·ä¾‹è®²è§£ã€‚</p></article>
    </section>

    <footer class="ui attached segment dream-tags">
      
        
          <a class="ui label" href="/tags/spice" title="spice">spice</a>
        
          <a class="ui label" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97" title="äº‘è®¡ç®—">äº‘è®¡ç®—</a>
        
      
      <div
        class="ui label"
        style="float: right; background: #1b1c1d !important; cursor: pointer;"
        onclick="savePostAsImg()">
        <i class="save icon"></i> Save as image
      </div>
    </footer>

    
      <footer class="ui attached segment">
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ã€‚
      </footer>
    

    
      <footer class="ui bottom attached stacked segment post-disqus-area" data-html2canvas-ignore="true">
        <div id="disqus_thread"></div>
        <script>
          


          var disqus_config = function () {
            this.page.url = 'https:\/\/hanamichi.wiki\/posts\/spice\/';  
            this.page.identifier = '\/posts\/spice\/'; 
          };

          (function() { 
            var d = document, s = d.createElement('script');
            s.src = 'https://' + 'x893675' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </footer>
    

  </div>
  <div class="sixteen wide mobile sixteen wide tablet four wide computer column">
    <article class="dream-header">
  <section class="ui top attached center aligned segment">
    <div class="ui small circular image">
      
        <img src="/me/hanamichi.jpg">
      
    </div>

    <h3 class="ui header">Hanamichiçš„åšå®¢<div class="sub header" style="margin-top: 0.5rem;">å‹¤ç»ƒå¸¦æ¥åŠ›é‡ï¼</div>
    </h3>

    <div class="ui horizontal list">
      
      <a class="item" href="/posts">
        <i class="archive icon" title="å½’æ¡£"></i>
      </a>
      
      <a class="item" href="/tags">
        <i class="tags icon" title="æ‰€æœ‰æ ‡ç­¾"></i>
      </a>
      <a class="item" href="/categories">
        <i class="th list icon" title="æ‰€æœ‰åˆ†ç±»"></i>
      </a>
    </div>
  </section>

  
  <section class="ui attached center aligned segment dream-tags">
    
      <a class="ui label" href="/tags/c&#43;&#43;" title="c&#43;&#43;">c&#43;&#43;</a>
    
      <a class="ui label" href="/tags/kubernetes" title="kubernetes">kubernetes</a>
    
      <a class="ui label" href="/tags/linux" title="linux">linux</a>
    
      <a class="ui label" href="/tags/spice" title="spice">spice</a>
    
      <a class="ui label" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97" title="äº‘è®¡ç®—">äº‘è®¡ç®—</a>
    
      <a class="ui label" href="/tags/%E7%94%9F%E6%B4%BB" title="ç”Ÿæ´»">ç”Ÿæ´»</a>
    
      <a class="ui label" href="/tags/%E8%B5%9E%E8%B5%8F" title="èµèµ">èµèµ</a>
    
  </section>
  

  
  <section class="ui attached segment dream-categories">
    <div class="ui accordion">
      
        <div class="title">
          <i class="dropdown icon"></i>
          <a href="/categories/linux" class="item">linux</a>
        </div>
        <div class="content">
          <div class="ui list">
          
            <div class="item">
              <div class="content">
                <a href="https://hanamichi.wiki/posts/linux-cmd/" class="item">linuxå¸¸ç”¨å‘½ä»¤è®°å½•</a>
              </div>
            </div>
          
          </div>
        </div>
      
        <div class="title">
          <i class="dropdown icon"></i>
          <a href="/categories/%E5%BA%95%E5%B1%82%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF" class="item">åº•å±‚è™šæ‹ŸåŒ–æŠ€æœ¯</a>
        </div>
        <div class="content">
          <div class="ui list">
          
            <div class="item">
              <div class="content">
                <a href="https://hanamichi.wiki/posts/spice-h264/" class="item">spiceå›¾å½¢æ˜¾ç¤ºä¼˜åŒ–</a>
              </div>
            </div>
          
            <div class="item">
              <div class="content">
                <a href="https://hanamichi.wiki/posts/spice/" class="item">äº‘æ¡Œé¢spiceåˆæ¢</a>
              </div>
            </div>
          
          </div>
        </div>
      
        <div class="title">
          <i class="dropdown icon"></i>
          <a href="/categories/%E7%94%9F%E6%B4%BB-%E9%9A%8F%E7%AC%94-%E6%80%BB%E7%BB%93" class="item">ç”Ÿæ´»-éšç¬”-æ€»ç»“</a>
        </div>
        <div class="content">
          <div class="ui list">
          
            <div class="item">
              <div class="content">
                <a href="https://hanamichi.wiki/posts/buy-me-a-coffee/" class="item">Buy Me A Coffee</a>
              </div>
            </div>
          
            <div class="item">
              <div class="content">
                <a href="https://hanamichi.wiki/posts/20180601%E9%9A%8F%E7%AC%94/" class="item">éšä¾¿æ‰¯æ‰¯æ·¡-2018/06</a>
              </div>
            </div>
          
            <div class="item">
              <div class="content">
                <a href="https://hanamichi.wiki/posts/20170321%E9%9A%8F%E7%AC%94/" class="item">éšä¾¿æ‰¯æ‰¯æ·¡-2017/03</a>
              </div>
            </div>
          
          </div>
        </div>
      
        <div class="title">
          <i class="dropdown icon"></i>
          <a href="/categories/%E7%9E%8E%E6%8A%98%E8%85%BE" class="item">çæŠ˜è…¾</a>
        </div>
        <div class="content">
          <div class="ui list">
          
            <div class="item">
              <div class="content">
                <a href="https://hanamichi.wiki/posts/aliyun-k8s/" class="item">é˜¿é‡Œäº‘k8sç¯å¢ƒæ­å»ºæµ‹è¯•</a>
              </div>
            </div>
          
          </div>
        </div>
      
        <div class="title">
          <i class="dropdown icon"></i>
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0" class="item">ç¼–ç¨‹è¯­è¨€å­¦ä¹ </a>
        </div>
        <div class="content">
          <div class="ui list">
          
            <div class="item">
              <div class="content">
                <a href="https://hanamichi.wiki/posts/c-plus-plus-gist/" class="item">C&#43;&#43;å•ä¾‹æ¨¡å¼ä¸çº¿ç¨‹ç±»æ€è€ƒ</a>
              </div>
            </div>
          
          </div>
        </div>
      
    </div>
  </section>
  

  <section class="ui bottom attached center aligned segment">
      
      <p>Â© 2017 - 2020 Hanamichiçš„åšå®¢</p>
      
      <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/g1eny0ung/hugo-theme-dream" target="_blank">Dream</a>.</p>
  </section>
</article>

  </div>
</div>

        </section>
        <section class="back">
          
<nav class="ui secondary inverted menu dream-menu">

  <div class="item">
    <i class="large link bullseye icon dream-flip-toggle" title="ç¿»è½¬ï¼"></i>
  </div>
  <div class="item">
    <i class="large link home icon" title="é¦–é¡µ" onclick="window.location.href = 'https:\/\/hanamichi.wiki'"></i>
  </div>
  <div class="item">
    <i id="theme-switch" class="large link icon" onclick="themeSwitch()"></i>
  </div>
</nav>

          <div class="ui centered relaxed grid dream-grid dream-back">
  
    <section class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
      <article>
        <div class="ui top attached segment">
          <h3 class="ui header">å…³äºæˆ‘</h3>
        </div>
        <div class="ui attached segment markdown-body">
          <p>å…³äºæˆ‘</p>
<p>Hanamichi çš„â¤åšå®¢</p>
<p>è®°å½•ä¸€äº›ğŸŒˆç”Ÿæ´»ä¸Šï¼ŒæŠ€æœ¯ä¸Šçš„äº‹</p>
<p>èŒä¸šæ˜¯åç«¯å·¥ç¨‹å¸ˆ</p>
<p>æ­£åœ¨åŠªåŠ›å­¦ä¹ </p>
<p>å¯¹äº‘åŸç”Ÿå¾®æœåŠ¡æ„Ÿå…´è¶£</p>
<p>ä¸»è¦çš„æŠ€æœ¯æ ˆæ˜¯ï¼š</p>
<ul>
<li>golang</li>
<li>kubernetes</li>
<li>python</li>
</ul>
<p>å­¦ä¹ ä¸­ï¼š</p>
<ul>
<li>Rust</li>
<li>C/C++</li>
<li>JavaScript</li>
</ul>
<p>ç›®å‰åœ¨ <a href="http://www.99cloud.net">99cloud</a> å·¥ä½œ</p>
<p>&ndash; 2019 å¹´ 12 æœˆ 31 æ—¥æ›´æ–°</p>
        </div>
      </article>
    </section>
  
    <section class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
      <article>
        <div class="ui top attached segment">
          <h3 class="ui header">æˆ‘çš„ä¸€äº›å¼€æºé¡¹ç›®</h3>
        </div>
        <div class="ui attached segment markdown-body">
          <p>æˆ‘çš„ä¸€äº›å¼€æºé¡¹ç›®</p>
<ul>
<li><a href="https://github.com/x893675/note">å­¦ä¹ ç¬”è®°</a> â¡ ä½¿ç”¨github issueå’Œwikiè®°å½•ç¬”è®°</li>
<li><a href="https://github.com/x893675/hal9000">hal9000</a> â¡ golangå¾®æœåŠ¡å¼€å‘å­¦ä¹ </li>
</ul>
        </div>
      </article>
    </section>
  
    <section class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
      <article>
        <div class="ui top attached segment">
          <h3 class="ui header">å…¶ä»–</h3>
        </div>
        <div class="ui attached segment markdown-body">
          <p>å…¶ä»–</p>
<p>å¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç«  or æˆ‘çš„é¡¹ç›®ï¼Œæˆ–è€…å®ƒä»¬å¯ä»¥ç»™ä½ å¸¦æ¥å¸®åŠ©ã€‚</p>
<p>You can <a href="/posts/buy-me-a-coffee">buy me a coffee</a>. ~</p>
<p>æˆ‘çš„<strong>å¾®ä¿¡èµèµç </strong>ï¼š</p>
<p><img class="ui image" src="/me/å¾®ä¿¡èµèµç .jpg" alt="wechat" /></p>
        </div>
      </article>
    </section>
  

  <section class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
    <article>
      <div class="ui top attached segment">
        <h3 class="ui header">ç¤¾äº¤é“¾æ¥</h3>
      </div>
      <div class="ui attached segment">
        <nav class="ui secondary menu dream-menu">
          
            <div class="item">
              <a href="mailto:x893675@gmail.com">
                <i class="large mail icon" title="email"></i>
              </a>
            </div>
          

          
            <div class="item">
              <a href="https://github.com/x893675" target="_blank">
                <i class="large github icon" title="github"></i>
              </a>
            </div>
          

          

          

          
        </nav>
      </div>
    </article>
  </section>

  <section class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
    
      <footer class="ui segment">
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ã€‚
      </footer>
    
  </section>

  
  
</div>

        </section>
      </div>
    </div>

    <script src="/js/jquery.min.js"></script>
<script src="/js/semantic.min.js"></script>
<script src="/js/imagesloaded.pkgd.min.js"></script>
<script src="/js/masonry.pkgd.min.js"></script>
<script src="/js/nav.js"></script>
<script src="/js/header.js"></script>
<script src="/js/main.js"></script>
<script src="/js/theme.js"></script>
<script src="/js/html2canvas.min.js"></script>


  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-156166070-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



  </body>
</html>
